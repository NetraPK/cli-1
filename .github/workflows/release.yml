on:
  release:
    types: [prereleased]

jobs:
  create-ticket:
    runs-on: ubuntu-latest
    name: Create a CCB ticket in Jira
    steps:
      - name: Create ticket
        env:
          JIRA_HOST: ${{ secrets.JIRA_BASE_URL }}
          PERSONAL_ACCESS_TOKEN: ${{ secrets.JIRA_PERSONAL_ACCESS_TOKEN }}
          JIRA_PROJECT_ID: 20084
          TOKEN_BASED_AUTH: true
          # @see https://docs.github.com/en/rest/reference/releases#get-a-release
          GITHUB_RELEASE_BODY: ${{ github.event.release.body }}
          GITHUB_RELEASE_NAME: ${{ github.event.release.name }}
          GITHUB_ACTIONS_RUN_URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
        run: ${GITHUB_WORKSPACE}/.github/workflows/create-ccb-ticket.sh
        shell: bash
