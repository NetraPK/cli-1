on:
  release:
    types: [prereleased]

jobs:
  create-ticket:
    runs-on: ubuntu-latest
    name: Create a CCB ticket in Jira
    steps:
      - name: Create ticket
        env:
          JIRA_USER: ${{ secrets.JIRA_USER }}
          JIRA_PASSWORD: ${{ secrets.JIRA_PASSWORD }}
          JIRA_BASE_API_URL: ${{ secrets.JIRA_BASE_API_URL }}
          JIRA_PROJECT_ID: 20084
        run: | 
          curl \
          -D- \
          -u $JIRA_USER:JIRA_PASSWORD \
          -X POST \
          --data "{ \
            \"fields\": { \
              \"project\": { \
                \"key\": \"${JIRA_PROJECT_ID}\", \
              }" \
              \"summary\": \"the summary\", \
              \"description\": \"the description\", \
              \"issuetype\": { \
                \"name\": \"task\", \
              }" \
            }" \
          -H "Content-Type: application/json" \
          $JIRA_BASE_API_URL/$JIRA_PROJECT_ID/issue/
        shell: bash
